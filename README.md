# COVID-19 Analysis Pipeline

–ü—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –∏ –∞–Ω–∞–ª–∏–∑ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö COVID-19 —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Hadoop, Hive, Spark –∏ PySpark. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Ä–∞–±–æ—Ç—ã —Å—Ç—Ä–æ—è—Ç—Å—è –æ—Ç—á—ë—Ç—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —ç–ø–∏–¥–µ–º–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –¥–∞–Ω–Ω—ã–º, –≤—ã–≥—Ä—É–∂–∞—é—Ç—Å—è parquet-—Ñ–∞–π–ª—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

‚ÑπÔ∏è –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π ETL-–ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö COVID-19. –û—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã –ø–∞–π–ø–ª–∞–π–Ω–∞:

#### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ HDFS

#### 2. –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ CSV-—Ñ–∞–π–ª–æ–≤ (–æ—á–∏—Å—Ç–∫–∞, —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∏–∞–≥–Ω–æ–∑–æ–≤)

#### 3. –°–æ–∑–¥–∞–Ω–∏–µ Hive-—Ç–∞–±–ª–∏—Ü —Å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –±–∞–∫–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

#### 4. SQL-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (–æ–∫–Ω–∞, join-–æ–ø–µ—Ä–∞—Ü–∏–∏, –∞–≥—Ä–µ–≥–∞—Ü–∏–∏)

#### 5. PySpark UDF-–æ–±—Ä–∞–±–æ—Ç–∫–∞

#### 6. –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ (–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è KMeans)

#### 7. –í—ã–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Parquet

#### 8. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ Jupyter Notebook

# –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç—á—ë—Ç–æ–≤ –∏ BI-–ø–ª–∞—Ç—Ñ–æ—Ä–º.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
TSU/
‚îÇ
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ images/                         # –ò—Å—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)
‚îÇ   ‚îú‚îÄ‚îÄ processed/                      # –ò—Ç–æ–≥–æ–≤—ã–µ parquet-—Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ –ø–∞–π–ø–ª–∞–π–Ω–∞
‚îÇ      ‚îú‚îÄ‚îÄ covid_only.parquet
‚îÇ      ‚îú‚îÄ‚îÄ kmeans_clusters.parquet
‚îÇ      ‚îú‚îÄ‚îÄ metadata_with_udf.parquet
‚îÇ      ‚îú‚îÄ‚îÄ query1_top_patients.parquet
‚îÇ      ‚îú‚îÄ‚îÄ query2_views_join.parquet
‚îÇ      ‚îú‚îÄ‚îÄ query3_covid_stats.parquet
‚îÇ   ‚îú‚îÄ‚îÄ metadata.csv                    # –ò—Å—Ö–æ–¥–Ω—ã–π CSV —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ metadata_cleaned.csv            # –û—á–∏—â–µ–Ω–Ω—ã–π CSV-—Ñ–∞–π–ª
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îú‚îÄ‚îÄ postgresql-42.5.0.jar           # –î—Ä–∞–π–≤–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã hive metastore —Å postgresql
‚îú‚îÄ‚îÄ hadoop-conf/                        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è hadoop
‚îú‚îÄ‚îÄ hive-conf/                          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è hive metastore
‚îú‚îÄ‚îÄ notebooks/                          # –†–∞–±–æ—á–∞—è –ø–∞–ø–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ hadoop.ipynb                    # –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ hdfs –∏ –ø—Ä–µ–¥–æ–±—Ä–∞—Ç–æ–Ω–Ω–æ–≥–æ csv
‚îÇ   ‚îú‚îÄ‚îÄ preprocess.ipynb                # –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö  csv –∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ spark.ipynb                     # –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å hive metastore –∏ hdfs —Å –ø–æ–º–æ—â—å—é spark. –°–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ parquet —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ visualize.ipynb                 # –°–∫—Ä–∏–ø—Ç –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Ç–æ–≥–æ–≤
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ docker-compose.yml                  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ Docker
‚îú‚îÄ‚îÄ dockerile                           # Dockerfile –¥–ª—è Jupiter
‚îî‚îÄ‚îÄ README.md
```
## üöÄ –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–æ–≤
```bash
docker-compose build
```
### 2. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –≤ —Ñ–æ–Ω–µ
```bash
docker-compose up -d
```
### 3. –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä hadoop-namenode –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–æ–∫ —Å –Ω—É–∂–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
```bash
docker exec -it hadoop-namenode sh
hdfs dfs -mkdir /user

# –°–¥–µ–ª–∞–π –ø–æ–¥ –Ω–µ—ë –ø–∞–ø–∫—É –ø–æ–¥ —Å–≤–æ–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
hdfs dfs -mkdir /user/hadoop

# –î–∞–π –Ω–∞ –Ω–µ—ë –ø—Ä–∞–≤–∞
hdfs dfs -chown hadoop:hadoop /user/hadoop

hdfs dfs -chmod 777 /user/hadoop/metadata

```
### 7. –ó–∞–ø—É—Å–∫ –Ω–æ—É—Ç–±—É–∫–æ–≤
–í–Ω—É—Ç—Ä–∏ jupiter –Ω–æ—É—Ç–±—É–∫–∞ –Ω–∞ localhost:8888 –∑–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã –≤ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ—Å–æ–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
1.preprocess.ipynb
2.hadoop.ipynb
3.spark.ipynb

### 8. –í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä NameNode
```bash
docker exec -it namenode sh
```
### 9. –í—ã–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ HDFS –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
üí° 
```bash
hdfs dfs -get /user/hadoop/covid_dataset/processed /data/results
```
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞ –≤—ã–π—Ç–∏ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
exit
```
### 10. –í—ã–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—É
```
–î–ª—è Linux:
```bash
docker cp namenode:/data/results ./data/processed
```
## ‚úÖ –ü–æ—Å–ª–µ –≤—ã–≥—Ä—É–∑–∫–∏
–í—Å–µ parquet-—Ñ–∞–π–ª—ã –±—É–¥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –ø–∞–ø–∫–µ:
```text
data/processed
```
–Ω–∞ –≤–∞—à–µ–π —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ. –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π –∏ –∞–Ω–∞–ª–∏–∑–∞ –≤ Jupyter Notebook –∏–ª–∏ –¥—Ä—É–≥–∏—Ö BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö.

üìä –†–∞–±–æ—Ç–∞ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è–º–∏

–ó–∞–ø—É—Å—Ç–∏—Ç–µ Jupyter Notebook:
```text
visualize.ipynb
```
